<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type" />
    <link rel="stylesheet" href="index.css">
  </head>
  <body class="c16 doc-content">
    <h1 class="c17" id="h.sydmgwocvvf3">
      <span class="c1 c18">Documentation</span>
    </h1>
    <h2 class="c5" id="h.8h9wdqgvgwib">
      <span class="c10 c1">Code Flow</span>
    </h2>
    <p class="c9 c8"><span class="c3 c7"></span></p>
    <ol class="c12 lst-kix_nscxlmdkpbk3-0 start" start="1">
      <li class="c9 c13 li-bullet-0">
        <span class="c1">Initialization:</span
        ><span class="c3 c7"
          >&nbsp;The RabbitCipher class is instantiated with a key and an IV.
          The key and IV are stored, and the internal state, counter, and carry
          are initialized.</span
        >
      </li>
    </ol>
    <p class="c4"><span class="c3 c7"></span></p>
    <ol class="c12 lst-kix_nscxlmdkpbk3-0" start="2">
      <li class="c9 c13 li-bullet-0">
        <span class="c1">Key Setup:</span
        ><span class="c3 c7"
          >&nbsp;The key is converted from bytes to an array of 16-bit integers.
          The state and counter arrays are initialized using these key values.
          The state is then updated four times, and the counter is adjusted by
          XORing it with the state.</span
        >
      </li>
    </ol>
    <p class="c4"><span class="c3 c7"></span></p>
    <ol class="c12 lst-kix_nscxlmdkpbk3-0" start="3">
      <li class="c9 c13 li-bullet-0">
        <span class="c1">IV Setup:</span
        ><span class="c3 c7"
          >&nbsp;If an IV is provided, it is converted from bytes to an array of
          16-bit integers. The counter is updated using the IV, and the state is
          updated four times again.</span
        >
      </li>
    </ol>
    <p class="c4"><span class="c3 c7"></span></p>
    <ol class="c12 lst-kix_nscxlmdkpbk3-0" start="4">
      <li class="c9 c13 li-bullet-0">
        <span class="c1">State Update:</span
        ><span class="c3 c7"
          >&nbsp;Calculates intermediate values g based on the current state and
          counter and updates the state array using nonlinear operations,
          including squaring and rotating values.</span
        >
      </li>
    </ol>
    <p class="c4"><span class="c3 c7"></span></p>
    <ol class="c12 lst-kix_nscxlmdkpbk3-0" start="5">
      <li class="c9 c13 li-bullet-0">
        <span class="c1">Keystream Extraction:</span
        ><span class="c3 c7"
          >&nbsp;Extracts 16 bytes of keystream from the current state with the
          help of the extract method.</span
        >
      </li>
    </ol>
    <p class="c4"><span class="c3 c7"></span></p>
    <ol class="c12 lst-kix_nscxlmdkpbk3-0" start="6">
      <li class="c9 c13 li-bullet-0">
        <span class="c1">Encryption/Decryption Process:</span
        ><span class="c3 c7"
          >&nbsp;The process method is called with the plaintext (for
          encryption) or ciphertext (for decryption). It initializes the key and
          IV, then iterates through the data byte by byte. Every 16 bytes, it
          updates the state and extracts a new keystream. Each byte of data is
          XORed with the corresponding byte from the keystream.</span
        >
      </li>
    </ol>
    <p class="c4"><span class="c3 c7"></span></p>
    <ol class="c12 lst-kix_nscxlmdkpbk3-0" start="7">
      <li class="c9 c13 li-bullet-0">
        <span class="c1">Output:</span
        ><span class="c3 c7"
          >&nbsp;The encrypted data (ciphertext) is printed. When decrypting,
          the same process is followed, and the decrypted data is printed, which
          should match the original plaintext.</span
        >
      </li>
    </ol>
    <p class="c9 c8"><span class="c3 c7"></span></p>
    <h2 class="c5" id="h.cexdvtf4tfys">
      <span class="c10 c1">Code Explanation</span>
    </h2>
    <p class="c2">
      <span class="c3 c7"
        >
        <img src="https://www.canva.com/design/DAGGkdsDiPc/_2QqaWU0RubufObn2H3f3A/view?utm_content=DAGGkdsDiPc&utm_campaign=designshare&utm_medium=link&utm_source=editor"
          alt="Rabbit Cipher" width="300" height="600">
        </span
      >
    </p>
    <h3 class="c15" id="h.qa9niucpizsw">
      <span class="c14 c7">Class Initialization</span>
    </h3>
    <ul class="c12 lst-kix_exd5sfrnflh-0 start">
      <li class="c6 li-bullet-0">
        <span class="c0">class RabbitCipher</span
        ><span class="c3 c7"
          >: Defines a new class for the Rabbit stream cipher.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">def init(self, key, iv=None)</span
        ><span class="c3 c7"
          >: Constructor method to initialize the cipher with a key and an
          optional IV.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">self.key = key</span
        ><span class="c3 c7">: Stores the provided key.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">self.iv = iv</span
        ><span class="c3 c7"
          >: Stores the provided IV (initialization vector), if any.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">self.state = [0] * 8</span
        ><span class="c3 c7"
          >: Initializes the internal state array with eight zeros.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">self.counter = [0] * 8</span
        ><span class="c3 c7"
          >: Initializes the counter array with eight zeros.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">self.carry = 0</span
        ><span class="c3 c7">: Initializes the carry variable to zero.</span>
      </li>
    </ul>
    <h3 class="c15" id="h.2j3wcbq6orf6">
      <span class="c14 c7">Key Setup</span>
    </h3>
    <ul class="c12 lst-kix_sng2w6vqiqx7-0 start">
      <li class="c6 li-bullet-0">
        <span class="c0">def setup_key(self)</span
        ><span class="c3 c7">: Defines a method to set up the key.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0"
          >key = [self.key[i] | (self.key[i + 1] &lt;&lt; 8) for i in range(0,
          16, 2)]</span
        ><span class="c3 c7"
          >: Converts the key from bytes to an array of 16-bit integers.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">for i in range(8</span
        ><span class="c3 c7"
          >): Loops over the eight elements of the state and counter
          arrays.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">if i % 2 == 0</span
        ><span class="c3 c7"
          >: Handles even indices separately from odd ones.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0"
          >self.state[i] = key[(i + 1) % 8] &lt;&lt; 16 | key[i]</span
        ><span class="c3 c7">: Initializes the state array.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0"
          >self.counter[i] = key[(i + 4) % 8] &lt;&lt; 16 | key[(i + 5) %
          8]</span
        ><span class="c3 c7"
          >: Initializes the counter array for even indices.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0"
          >self.state[i] = key[(i + 5) % 8] &lt;&lt; 16 | key[i]</span
        ><span class="c3 c7"
          >: Initializes the state array for odd indices.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0"
          >self.counter[i] = key[(i + 4) % 8] &lt;&lt; 16 | key[(i + 3) %
          8]</span
        ><span class="c3 c7"
          >: Initializes the counter array for odd indices.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">for _ in range(4)</span
        ><span class="c3 c7">: Repeats the state update four times.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">self.next_state()</span
        ><span class="c3 c7">: Updates the state.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">for i in range(8)</span
        ><span class="c3 c7"
          >: Loops over the state and counter arrays again.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">self.counter[i] ^= self.state[(i + 4) &amp; 7]</span
        ><span class="c3 c7">: XORs the state into the counter.</span>
      </li>
    </ul>
    <h3 class="c15" id="h.95wskg67zths">
      <span class="c7 c14">IV Setup</span>
    </h3>
    <ul class="c12 lst-kix_w4inz1spbjtv-0 start">
      <li class="c6 li-bullet-0">
        <span class="c0">def setup_iv(self)</span
        ><span class="c3 c7">: Defines a method to set up the IV.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">if self.iv is None</span
        ><span class="c3 c7">: Checks if the IV is provided.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">return</span
        ><span class="c3 c7">: Exits the method if no IV is provided.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0"
          >iv = [self.iv[i] | (self.iv[i + 1] &lt;&lt; 8) for i in range(0, 8,
          2)]</span
        ><span class="c3 c7"
          >: Converts the IV from bytes to an array of 16-bit integers.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">for i in range(8)</span
        ><span class="c3 c7"
          >: Loops over the eight elements of the counter array.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0"
          >self.counter[i] ^= (iv[i % 4] &lt;&lt; 16) | iv[(i + 1) % 4]</span
        ><span class="c3 c7">: XORs the IV into the counter.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">for _ in range(4)</span
        ><span class="c3 c7">: Repeats the state update four times.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">self.next_state()</span
        ><span class="c3 c7">: Updates the state.</span>
      </li>
    </ul>
    <h3 class="c15" id="h.cpxry23sndmc">
      <span class="c14 c7">State Update</span>
    </h3>
    <ul class="c12 lst-kix_q3tdhve2muv0-0 start">
      <li class="c6 li-bullet-0">
        <span class="c0">def next_state(self)</span
        ><span class="c3 c7">: Defines a method to update the state.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">g = [0] * 8</span
        ><span class="c3 c7">: Initializes an array g with eight zeros.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">for i in range(8)</span
        ><span class="c3 c7"
          >: Loops over the eight elements of the state and counter
          arrays.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0"
          >s = (self.state[i] + self.counter[i] + (self.carry if i == 0 else 0))
          &amp; 0xFFFFFFFF</span
        ><span class="c3 c7">: Calculates an intermediate value s.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0"
          >self.carry = (s &lt; self.state[i]) or (s &lt; self.counter[i]) or (s
          &lt; (self.carry if i == 0 else 0))</span
        ><span class="c3 c7">: Updates the carry bit.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">g[i] = (s * s) &amp; 0xFFFFFFFF</span
        ><span class="c3 c7">: Calculates the low 32 bits of s squared.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">g[i] ^= (s * s) &gt;&gt; 32</span
        ><span class="c3 c7"
          >: XORs the high 32 bits of s squared into g[i].</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">for i in range(8)</span
        ><span class="c3 c7"
          >: Loops over the eight elements of the state array.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0"
          >self.state[i] = (g[i] + self.rotate(g[(i + 7) &amp; 7], 16) +
          self.rotate(g[(i + 6) &amp; 7], 16)) &amp; 0xFFFFFFFF</span
        ><span class="c3 c7">: Updates the state with new values.</span>
      </li>
    </ul>
    <h3 class="c15" id="h.xje86fsahhm3">
      <span class="c14 c7">Helper Method</span>
    </h3>
    <ul class="c12 lst-kix_zcdggp9gdy4a-0 start">
      <li class="c6 li-bullet-0">
        <span class="c0">@staticmethod</span
        ><span class="c3 c7"
          >: Declares a static method that doesn&#39;t use the class
          instance.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">def rotate(value, shift)</span
        ><span class="c3 c7"
          >: Defines a method to rotate a 32-bit integer value by shift
          bits.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0"
          >return ((value &lt;&lt; shift) &amp; 0xFFFFFFFF) | (value &gt;&gt;
          (32 - shift))</span
        ><span class="c3 c7">: Performs the rotation.</span>
      </li>
    </ul>
    <h3 class="c15" id="h.nz9e1unx1ru8">
      <span class="c14 c7">Keystream Extraction</span>
    </h3>
    <ul class="c12 lst-kix_ofjkoclxh6i0-0 start">
      <li class="c6 li-bullet-0">
        <span class="c0">def extract(self)</span
        ><span class="c3 c7">: Defines a method to extract the keystream.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">keystream = bytearray(16)</span
        ><span class="c3 c7"
          >: Initializes a keystream buffer of 16 bytes.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">for i in range(8)</span
        ><span class="c3 c7"
          >: Loops over the eight elements of the state array.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">keystream[2 * i] = self.state[i] &amp; 0xFF</span
        ><span class="c3 c7"
          >: Stores the low byte of state[i] in the keystream.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0"
          >keystream[2 * i + 1] = (self.state[i] &gt;&gt; 8) &amp; 0xFF</span
        ><span class="c3 c7"
          >: Stores the next byte of state[i] in the keystream.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">return keystream</span
        ><span class="c3 c7">: Returns the keystream buffer.</span>
      </li>
    </ul>
    <h3 class="c15" id="h.gpu9vi8mlxup">
      <span class="c14 c7">Data Processing</span>
    </h3>
    <ul class="c12 lst-kix_cznfflbywnwz-0 start">
      <li class="c6 li-bullet-0">
        <span class="c0">self.setup_key()</span
        ><span class="c3 c7"
          >: Calls the setup_key method to initialize the state and counter with
          the key.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">self.setup_iv()</span
        ><span class="c3 c7"
          >: Calls the setup_iv method to initialize the counter with the IV if
          provided.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">result = bytearray()</span
        ><span class="c3 c7"
          >: Initializes an empty byte array to store the result.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">for i, byte in enumerate(data)</span
        ><span class="c3 c7">: Iterates over each byte in the input data.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">if i % 16 == 0:</span
        ><span class="c3 c7"
          >&nbsp;Checks if a new keystream block is needed (every 16
          bytes).</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">self.next_state(): </span
        ><span class="c3 c7">Updates the internal state.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">keystream = self.extract(): </span
        ><span class="c3 c7">Extracts a new keystream block.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">result.append(byte ^ keystream[i % 16])</span
        ><span class="c3 c7"
          >: XORs the input byte with the corresponding keystream byte and
          appends the result.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">return bytes(result): </span
        ><span class="c3 c7"
          >Converts the result to a bytes object and returns it.</span
        >
      </li>
    </ul>
    <h3 class="c15" id="h.wvifgcckb9hp">
      <span class="c14 c7">Encryption and Decryption</span>
    </h3>
    <ul class="c12 lst-kix_fmxxw8siwgz0-0 start">
      <li class="c6 li-bullet-0">
        <span class="c0">def encrypt(self, plaintext): </span
        ><span class="c3 c7">Defines the encryption method.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">return self.process(plaintext):</span
        ><span class="c3 c7"
          >&nbsp;Calls the process method to encrypt the plaintext.</span
        >
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">def decrypt(self, ciphertext):</span
        ><span class="c3 c7">&nbsp;Defines the decryption method.</span>
      </li>
      <li class="c6 li-bullet-0">
        <span class="c0">return self.process(ciphertext):</span
        ><span class="c3 c7"
          >&nbsp;Calls the process method to decrypt the ciphertext.</span
        >
      </li>
    </ul>
    <h3 class="c15" id="h.qxg2w0dyf8gm"><span class="c14 c7">Testing</span></h3>
    <p class="c9 c8"><span class="c3 c7"></span></p>
    <p class="c9">
      <span class="c3 c7"
        >![Rabbit Cipher
        Example](https://www.canva.com/design/DAGGkPaXVFU/O3bu8rivnwiFKAGL9egqlg/view?utm_content=DAGGkPaXVFU&amp;utm_campaign=designshare&amp;utm_medium=link&amp;utm_source=editor)</span
      >
    </p>
    <p class="c9 c8"><span class="c3 c7"></span></p>
    <p class="c9 c8"><span class="c3 c7"></span></p>
    <h2 class="c5" id="h.62kigs1fvbwi">
      <span class="c10 c1">Defending Implementation</span>
    </h2>
    <p class="c8 c9"><span class="c3 c7"></span></p>
    <ol class="c12 lst-kix_l5vdt3c579wk-0 start" start="1">
      <li class="c9 c13 li-bullet-0">
        <span class="c1">Key and IV Setup:</span
        ><span class="c3 c7"
          >&nbsp;Proper initialization of the state and counter arrays based on
          a 128-bit key and a 64-bit IV ensures strong security.</span
        >
      </li>
    </ol>
    <p class="c4"><span class="c3 c7"></span></p>
    <ol class="c12 lst-kix_l5vdt3c579wk-0" start="2">
      <li class="c9 c13 li-bullet-0">
        <span class="c1">State Update Function:</span
        ><span class="c3 c7"
          >&nbsp;The next_state method performs a complex and secure update of
          the internal state using nonlinear operations, including squaring and
          rotating bits, ensuring a pseudorandom keystream.</span
        >
      </li>
    </ol>
    <p class="c4"><span class="c3 c7"></span></p>
    <ol class="c12 lst-kix_l5vdt3c579wk-0" start="3">
      <li class="c9 c13 li-bullet-0">
        <span class="c1">Keystream Generation:</span
        ><span class="c3 c7"
          >&nbsp;The extract method correctly derives the keystream from the
          state, ensuring that encryption and decryption processes are
          reversible.</span
        >
      </li>
    </ol>
    <p class="c4"><span class="c3 c7"></span></p>
    <ol class="c12 lst-kix_l5vdt3c579wk-0" start="4">
      <li class="c9 c13 li-bullet-0">
        <span class="c1">Encryption/Decryption Symmetry:</span
        ><span class="c3 c7"
          >&nbsp;The process method uses the same logic for both encryption and
          decryption, making the code simple and effective.</span
        >
      </li>
    </ol>
    <p class="c4"><span class="c3 c7"></span></p>
    <ol class="c12 lst-kix_l5vdt3c579wk-0" start="5">
      <li class="c9 c13 li-bullet-0">
        <span class="c1">Performance and Simplicity:</span
        ><span class="c3 c7"
          >&nbsp;The code is optimized for performance with efficient
          operations, and it is structured in a clear, understandable manner,
          making it easy to follow and maintain.</span
        >
      </li>
    </ol>
    <p class="c9 c8"><span class="c3 c7"></span></p>
    <p class="c9 c8"><span class="c3 c7"></span></p>
    <h2 class="c5" id="h.1zryge93rhtx">
      <span class="c1 c10">Complete Code</span>
    </h2>
    <p class="c2 c8"><span class="c3 c11"></span></p>
    <p class="c2"><span class="c3 c0">class RabbitCipher:</span></p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; def __init__(self, key, iv=None):</span>
    </p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; &nbsp; &nbsp; self.key = key</span>
    </p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; &nbsp; &nbsp; self.iv = iv</span>
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; self.state = [0] * 8</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; self.counter = [0] * 8</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; &nbsp; &nbsp; self.carry = 0</span>
    </p>
    <p class="c2 c8"><span class="c3 c0"></span></p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; def setup_key(self):</span>
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; key = [self.key[i] | (self.key[i + 1]
        &lt;&lt; 8) for i in range(0, 16, 2)]</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; &nbsp; &nbsp; for i in range(8):</span>
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if i % 2 == 0:</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.state[i] =
        key[(i + 1) % 8] &lt;&lt; 16 | key[i]</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.counter[i]
        = key[(i + 4) % 8] &lt;&lt; 16 | key[(i + 5) % 8]</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else:</span>
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.state[i] =
        key[(i + 5) % 8] &lt;&lt; 16 | key[i]</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.counter[i]
        = key[(i + 4) % 8] &lt;&lt; 16 | key[(i + 3) % 8]</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; &nbsp; &nbsp; for _ in range(4):</span>
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.next_state()</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; &nbsp; &nbsp; for i in range(8):</span>
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.counter[i] ^=
        self.state[(i + 4) &amp; 7]</span
      >
    </p>
    <p class="c2 c8"><span class="c3 c0"></span></p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; def setup_iv(self):</span>
    </p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; &nbsp; &nbsp; if self.iv is None:</span>
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; iv = [self.iv[i] | (self.iv[i + 1] &lt;&lt;
        8) for i in range(0, 8, 2)]</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; &nbsp; &nbsp; for i in range(8):</span>
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.counter[i] ^= (iv[i % 4]
        &lt;&lt; 16) | iv[(i + 1) % 4]</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; &nbsp; &nbsp; for _ in range(4):</span>
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.next_state()</span
      >
    </p>
    <p class="c2 c8"><span class="c3 c0"></span></p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; def next_state(self):</span>
    </p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; &nbsp; &nbsp; g = [0] * 8</span>
    </p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; &nbsp; &nbsp; for i in range(8):</span>
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s = (self.state[i] +
        self.counter[i] + (self.carry if i == 0 else 0)) &amp; 0xFFFFFFFF</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.carry = (s &lt;
        self.state[i]) or (s &lt; self.counter[i]) or (s &lt; (self.carry if i
        == 0 else 0))</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; g[i] = (s * s) &amp;
        0xFFFFFFFF</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; g[i] ^= (s * s) &gt;&gt;
        32</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; &nbsp; &nbsp; for i in range(8):</span>
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.state[i] = (g[i] +
        self.rotate(g[(i + 7) &amp; 7], 16) + self.rotate(g[(i + 6) &amp; 7],
        16)) &amp; 0xFFFFFFFF</span
      >
    </p>
    <p class="c2 c8"><span class="c3 c0"></span></p>
    <p class="c2"><span class="c3 c0">&nbsp; &nbsp; @staticmethod</span></p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; def rotate(value, shift):</span>
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; return ((value &lt;&lt; shift) &amp;
        0xFFFFFFFF) | (value &gt;&gt; (32 - shift))</span
      >
    </p>
    <p class="c2 c8"><span class="c3 c0"></span></p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; def extract(self):</span>
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; keystream = bytearray(16)</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; &nbsp; &nbsp; for i in range(8):</span>
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keystream[2 * i] =
        self.state[i] &amp; 0xFF</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keystream[2 * i + 1] =
        (self.state[i] &gt;&gt; 8) &amp; 0xFF</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; &nbsp; &nbsp; return keystream</span>
    </p>
    <p class="c2 c8"><span class="c3 c0"></span></p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; def process(self, data):</span>
    </p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; &nbsp; &nbsp; self.setup_key()</span>
    </p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; &nbsp; &nbsp; self.setup_iv()</span>
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; result = bytearray()</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; for i, byte in enumerate(data):</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if i % 16 == 0:</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
        self.next_state()</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keystream =
        self.extract()</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result.append(byte ^
        keystream[i % 16])</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; return bytes(result)</span
      >
    </p>
    <p class="c2 c8"><span class="c3 c0"></span></p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; def encrypt(self, plaintext):</span>
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; return self.process(plaintext)</span
      >
    </p>
    <p class="c2 c8"><span class="c3 c0"></span></p>
    <p class="c2">
      <span class="c3 c0">&nbsp; &nbsp; def decrypt(self, ciphertext):</span>
    </p>
    <p class="c2">
      <span class="c3 c0"
        >&nbsp; &nbsp; &nbsp; &nbsp; return self.process(ciphertext)</span
      >
    </p>
    <p class="c2 c8"><span class="c3 c0"></span></p>
    <p class="c2 c8"><span class="c3 c0"></span></p>
    <p class="c2"><span class="c3 c0"># Test 1</span></p>
    <p class="c2">
      <span class="c3 c0"
        >key = b&#39;0123456789abcdef&#39; &nbsp; &nbsp; &nbsp; &nbsp; #
        &nbsp;Defines a 128-bit key</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0"
        >iv = b&#39;12345678&#39; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
        &nbsp; &nbsp; &nbsp;# Defines a 64-bit IV</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0">plaintext = b&#39;This is a test message.&#39;</span>
    </p>
    <p class="c2">
      <span class="c3 c0">print(&#39;Plaintext:&#39;, plaintext)</span>
    </p>
    <p class="c2 c8"><span class="c3 c0"></span></p>
    <p class="c2">
      <span class="c3 c0"
        >cipher = RabbitCipher(key, iv) &nbsp; &nbsp; &nbsp; &nbsp; # Creates a
        new RabbitCipher instance with the key and IV</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0"
        >ciphertext = cipher.encrypt(plaintext) # Encrypts the plaintext</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0">print(&#39;Ciphertext:&#39;, ciphertext)</span>
    </p>
    <p class="c2 c8"><span class="c3 c0"></span></p>
    <p class="c2">
      <span class="c3 c0"
        >decrypted = cipher.decrypt(ciphertext) # Decrypts the ciphertext</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0">print(&#39;Decrypted:&#39;, decrypted)</span>
    </p>
    <p class="c2 c8"><span class="c3 c0"></span></p>
    <p class="c2">
      <span class="c3 c0">print(&#39;----------------------&#39;)</span>
    </p>
    <p class="c2 c8"><span class="c3 c0"></span></p>
    <p class="c2"><span class="c3 c0"># Test 2</span></p>
    <p class="c2">
      <span class="c3 c0"># Explanation in the documentation</span>
    </p>
    <p class="c2 c8"><span class="c3 c0"></span></p>
    <p class="c2">
      <span class="c3 c0"
        >key = b&#39;0123456789abcdef&#39; &nbsp;# Shared secret key</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0"
        >iv = b&#39;12345678&#39; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Shared
        IV</span
      >
    </p>
    <p class="c2">
      <span class="c3 c0">plaintext = b&#39;Hello Alice!&#39;</span>
    </p>
    <p class="c2">
      <span class="c3 c0">print(&#39;Plaintext:&#39;, plaintext)</span>
    </p>
    <p class="c2 c8"><span class="c3 c0"></span></p>
    <p class="c2"><span class="c3 c0"># Bob encrypts the message</span></p>
    <p class="c2"><span class="c3 c0">cipher = RabbitCipher(key, iv)</span></p>
    <p class="c2">
      <span class="c3 c0">ciphertext = cipher.encrypt(plaintext)</span>
    </p>
    <p class="c2">
      <span class="c0 c3">print(&#39;Ciphertext:&#39;, ciphertext)</span>
    </p>
    <p class="c2">
      <span class="c3 c0"
        >print(&#39;Ciphertext (Hexadecimal Format):&#39;,
        ciphertext.hex())</span
      >
    </p>
    <p class="c2 c8"><span class="c3 c0"></span></p>
    <p class="c2"><span class="c3 c0"># Alice decrypts the message</span></p>
    <p class="c2">
      <span class="c3 c0">decrypted = cipher.decrypt(ciphertext)</span>
    </p>
    <p class="c2">
      <span class="c3 c0">print(&#39;Decrypted:&#39;, decrypted)</span>
    </p>
    <p class="c2 c8"><span class="c3 c11"></span></p>
    <p class="c9 c8"><span class="c3 c7"></span></p>
  </body>
</html>
